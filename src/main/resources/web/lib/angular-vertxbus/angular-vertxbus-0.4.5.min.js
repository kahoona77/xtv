(function(){var a,b={}.hasOwnProperty;a=angular.module("knalli.angular-vertxbus",["ng"]).value("enabled",!0).value("debugEnabled",!1).value("prefix","vertx-eventbus.").value("urlServer",""+location.protocol+"//"+location.hostname+":"+(location.port||80)).value("urlPath","/eventbus").value("reconnectEnabled",!0).value("sockjsStateInterval",1e4).value("sockjsReconnectInterval",1e4).value("sockjsOptions",{}),a.factory("vertxEventBus",["$timeout","prefix","urlServer","urlPath","sockjsOptions","enabled","debugEnabled","reconnectEnabled","sockjsReconnectInterval",function(a,b,c,d,e,f,g,h,i){var j,k,l,m,n;return m=null,j="undefined"!=typeof vertx&&null!==vertx?vertx.EventBus:void 0,f&&j?(n=""+c+d,g&&console.debug("[Vertex EventBus] Enabled: connecting '"+n+"'"),l=null,k=function(){l=new j(n,void 0,e),l.onopen=function(){g&&console.debug("[VertX EventBus] Connected"),"function"==typeof m.onopen&&m.onopen()},l.onclose=function(){g&&console.debug("[VertX EventBus] Reconnect in "+i+"ms"),"function"==typeof m.onclose&&m.onclose(),h&&a(k,i)}},k(),m={reconnect:function(){return l.close()},close:function(){return l.close()},login:function(a,b,c){return l.login(a,b,c)},send:function(a,b,c){return l.send(a,b,c)},publish:function(a,b){return l.publish(a,b)},registerHandler:function(a,b){return l.registerHandler(a,b)},unregisterHandler:function(a,b){return l.unregisterHandler(a,b)},readyState:function(){return l.readyState()},EventBus:j}):g&&console.debug("[VertX EventBus] Disabled"),m}]),a.service("vertxEventBusService",["$rootScope","$q","$interval","$timeout","vertxEventBus","prefix","enabled","debugEnabled","sockjsStateInterval",function(a,c,d,e,f,g,h,i,j){var k,l,m,n,o;return l=null!=f?null!=(o=f.EventBus)?o.CLOSED:void 0:void 0,h&&f&&(f.onopen=function(){var c,d,e,f,h,i;n.getConnectionState(!0),a.$broadcast(""+g+"system.connected"),i=n.handlers;for(c in i)if(b.call(i,c))for(e=i[c],f=0,h=e.length;h>f;f++)d=e[f],m.registerHandler(c,d);return a.$digest()},f.onclose=function(){return n.getConnectionState(!0),a.$broadcast(""+g+"system.disconnected")}),m={registerHandler:function(b,c){return"function"==typeof c?(i&&console.debug("[VertX EventBus] Register handler for "+b),f.registerHandler(b,function(b,d){return c(b,d),a.$digest()})):void 0},unregisterHandler:function(a,b){return"function"==typeof b?(i&&console.debug("[VertX EventBus] Unregister handler for "+a),f.unregisterHandler(a,b)):void 0},send:function(a,b,d,g){var h;return null==g&&(g=1e4),d&&(h=c.defer()),f.send(a,b,function(a){return h&&h.resolve(a),"function"==typeof d?d(a):void 0}),h&&e(function(){return h.reject()},g),null!=h?h.promise:void 0},publish:function(a,b){return f.publish(a,b)}},n={handlers:{},registerHandler:function(a,b){return n.handlers[a]||(n.handlers[a]=[]),n.handlers[a].push(b),l===f.EventBus.OPEN?m.registerHandler(a,b):void 0},unregisterHandler:function(a,b){var c;return n.handlers[a]&&b(n.handlers[a])&&(c=n.handlers[a].indexOf(b),c>-1&&n.handlers[a].splice(c,1)),l===f.EventBus.OPEN?m.unregisterHandler(a,b):void 0},send:function(a,b,d,e){return null==e&&(e=1e4),l===f.EventBus.OPEN?m.send(a,b,d,e):c.reject("unknown")},publish:function(a,b){return l===f.EventBus.OPEN?m.publish(a,b):void 0},getConnectionState:function(a){return(null!=f?f.EventBus:void 0)?h?a&&(l=f.readyState()):l=f.EventBus.CLOSED:l=3,l}},d(function(){return n.getConnectionState(!0)},j),k={on:n.registerHandler,addListener:n.registerHandler,un:n.unregisterHandler,removeListener:n.unregisterHandler,send:n.send,publish:n.publish,emit:n.publish,readyState:n.getConnectionState,isEnabled:function(){return h}}}])}).call(this);